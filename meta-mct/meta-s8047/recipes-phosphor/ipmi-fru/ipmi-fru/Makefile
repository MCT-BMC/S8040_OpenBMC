SRC = ipmi-fru.cpp ipmi-fru.hpp
SO_VERSION = 1
OUTPUT = libipmi-fru.so.$(SO_VERSION)
CFLAGS += -O3 -Wno-unused-result -std=c++20

BUILD_LIB = -shared -fPIC

BOOST_CXX_FLAG += -DBOOST_ERROR_CODE_HEADER_ONLY
BOOST_CXX_FLAG += -DBOOST_SYSTEM_NO_DEPRECATED
BOOST_CXX_FLAG += -DBOOST_ALL_NO_LIB
BOOST_CXX_FLAG += -DBOOST_NO_RTTI
BOOST_CXX_FLAG += -DBOOST_NO_TYPEID
BOOST_CXX_FLAG += -DBOOST_ASIO_DISABLE_THREADS
BOOST_CXX_FLAG += -DBOOST_COROUTINES_NO_DEPRECATION_WARNING

LIBS += -lsdbusplus -lsystemd -lipmid

all: $(SRC)
	$(CXX) $(BUILD_LIB) $(SRC) -o  $(OUTPUT) $(CFLAGS) $(LIBS) $(BOOST_CXX_FLAG)
clean:
	-rm -rf $(OUTPUT)